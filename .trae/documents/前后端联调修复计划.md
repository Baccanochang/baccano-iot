# 前后端联调修复计划

## 问题分析

1. **物模型接口路径不匹配**

   * 前端调用：`/api/v1/devices/:id/thing-model`

   * 后端实际：`/api/v1/products/:productId/thing-models/:version`

2. **RPC调用参数不匹配**

   * 前端请求体：`{ service, params }`

   * 后端期望：`{ method, params }`

3. **更新属性参数不匹配**

   * 前端请求体：`{ attributes }`

   * 后端期望：直接传入 `attributes` 对象

4. **缺少设备列表接口**

   * 前端未实现获取设备列表的API调用

5. **缺少产品相关API**

   * 前端未实现产品列表、创建产品等API调用

## 修复步骤

### 1. 修复前端API客户端

**文件：** `web-ui/src/api/client.ts` 和 `web-ui/src/api/devices/index.ts`

* [ ] 移除重复的API方法定义

* [ ] 修复物模型接口调用路径

* [ ] 修复RPC调用参数名称（将`service`改为`method`）

* [ ] 修复更新属性请求体格式

* [ ] 添加设备列表API调用

* [ ] 实现产品相关API调用

### 2. 修复设备管理API

**文件：** `web-ui/src/api/devices/index.ts`

* [ ] 添加产品API调用方法

* [ ] 修复物模型获取逻辑

### 3. 检查后端配置

**文件：** `baccano-server/internal/config/config.go`

* [ ] 检查默认端口配置（确保与前端默认配置匹配）

* [ ] 确保CORS配置正确

### 4. 启动前后端服务

* [ ] 启动后端服务

* [ ] 启动前端开发服务器

* [ ] 验证健康检查接口

### 5. 测试核心功能

* [ ] 测试设备列表获取

* [ ] 测试设备详情获取

* [ ] 测试物模型获取

* [ ] 测试设备影子操作

* [ ] 测试属性更新

* [ ] 测试RPC调用

## 预期结果

* 前后端API调用匹配

* 核心功能正常工作

* 无404或参数错误

* 可以正常进行设备管理操作

## 技术要点

* 确保API路径、请求方法、请求体格式完全匹配

* 注意参数名称的一致性

* 确保CORS配置允许前端访问

* 检查环境变量配置

## 风险评估

* 低风险：主要是API路径和参数的调整

* 修复后需要全面测试核心功能

* 确保不破坏现有功能

## 时间估算

* 修复前端API：30分钟

* 检查后端配置：15分钟

* 启动服务：10分钟

* 测试功能：30分钟

* 总计：约1小时35分钟

